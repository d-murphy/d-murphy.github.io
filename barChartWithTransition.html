<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Horizontal Bar Chart with Transition</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.2.0/d3.min.js"></script>
  </head>
  <body>
    <div>
      <h2>Horizontal Bar Chart with Transitions</h2>
    </div>
    <div id="chartDiv"></div>
    <script>
      var data = [
            {group: 1, stage: 1, value: 4}, 
            {group: 1, stage: 2, value: 8}, 
            {group: 2, stage: 1, value: 1}, 
            {group: 2, stage: 2, value: 8}, 
            {group: 3, stage: 1, value: 5}, 
            {group: 3, stage: 2, value: 11}, 
            {group: 4, stage: 1, value: 3}, 
            {group: 4, stage: 2, value: 6}, 
            {group: 5, stage: 1, value: 3}, 
            {group: 5, stage: 2, value: 9}, 
          ]

      var filterData = function(originalData, stage){
        var returnArr = [];
        originalData.map(function(d, i){if(d.stage==stage){returnArr.push(d)}})
        return(returnArr)
      }

      // consider using filter instead?

// reduce function wasn't necessary - there are d3 helpers

//      var findMax = function(currentData){
//          var maxToReturn = currentData.reduce(function(previous, d){
//                              return(previous > d.value ? previous : d.value)
//                              }, 0)
//          return(maxToReturn)
//        }





      var dataToDisplay = filterData(data,1)

      var chartHt = 200
      var chartWd = 500
      var chartOutPad = 4

      var yScale = d3.scaleBand()
                     .domain(d3.range(dataToDisplay.length))     
                     .rangeRound([chartOutPad, chartHt-chartOutPad])
                     .paddingInner(0.05)

      var xScale = d3.scaleLinear()
                     .domain([0,
                         d3.max(dataToDisplay, function(d) {return d.value; })
                        ])
                     .range([chartOutPad, chartWd - chartOutPad])

      svg=d3.select("#chartDiv")
          .append("svg")
          .attr("width", chartWd)
          .attr("height", chartHt)

      svg.selectAll("rect")
         .data(dataToDisplay)
         .enter()
         .append("rect")
         .attr("y", function(d,i) {
             return yScale(i); 
         })
         .attr("x", chartOutPad)
         .attr("height", yScale.bandwidth())
         .attr("width", function(d){
             return xScale(d.value)
         })
         .attr("fill", "#AAF0D1")

      </script>
    </body>
</html>
