<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Sunrise, Sunset in NY</title>
    <style>
	body {
	  font-family: Arial, Helvetica, sans-serif;
	  background: rgb(240,230,234);
	  background: radial-gradient(circle, rgba(240,230,234,1) 0%, rgba(94,156,230,1) 100%);
      background-repeat: no-repeat;
	}
    </style>
  </head>
  <body>
    <center>
    <h3>Sunrise, Sunset in New York, NY</h3>
    <p id="statusText">Showing Sunrise and Sunset with Daylight Savings Time.</p>
    <button id="transitionButton" onclick="reDrawPlot()">Show without DST</button>
    <div id="container"></div>
    <p><a href="https://www.timeanddate.com/sun/usa/new-york">Data Source</a></p>
    </center>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/6.0.0/d3.min.js'></script>
    <script src='sunriseLoadData.js'></script>
    <script>
      
      var h = 500; 
      var w = 700;
      var padding = 20; 
      var horizPadding = 60; 
      var showingDLS = true;
      var textVar = "Here is the text"

      var parseDate = d3.timeParse("%m/%d/%Y");
      var parseTime = d3.timeParse("%I:%M %p");

      for (i = 0; i < data.length; i++) {
        data[i].sunriseWoDLS = String(parseTime(data[i].sunrise).getHours() + parseInt(data[i].daylightSavings)) + ":" + 
				String(parseTime(data[i].sunrise).getMinutes() < 10 ? "0":"") + 
                               String(parseTime(data[i].sunrise).getMinutes()) + " am"
        data[i].sunsetWoDLS = String(parseTime(data[i].sunset).getHours() + parseInt(data[i].daylightSavings) - 12) + ":" + 
				String(parseTime(data[i].sunset).getMinutes() < 10 ? "0":"") + 
                               String(parseTime(data[i].sunset).getMinutes()) + " pm"
	data[i].xStart = data[i].sunrise
	data[i].xEnd = data[i].sunset

     }

     yScale = d3.scaleTime()
		 .domain([
			d3.min(data, function(d) {return parseDate(d.date)}),
			d3.max(data, function(d) {return parseDate(d.date)})
			])
		.range([h-padding,padding])

      xScale = d3.scaleTime()
		 .domain([
			d3.min(data, function(d) {return parseTime("3:00 am")}),
			d3.max(data, function(d) {return parseTime("10:00 pm")})
			])
		.range([horizPadding,(w-horizPadding)])

      var xAxis = d3.axisBottom()
		    .tickFormat(d3.timeFormat("%I:%M %p"))
		    .scale(xScale)
		    .ticks(6);

      var yAxis = d3.axisLeft()
		    .tickFormat(d3.timeFormat("%B"))
		    .scale(yScale);

      var svg = d3.select("#container").append("svg")
		  .attr("height", h) 
		  .attr("width", w) 

      var defs = svg.append("defs");
      var gradient = defs.append("linearGradient")
       .attr("id", "svgGradient")

      gradient.append("stop")
      .attr('class', 'start')
      .attr("offset", "0%")
      .attr("stop-color", "#f0e6ea")

      gradient.append("stop")
      .attr('class', 'mid')
      .attr("offset", "50%")
      .attr("stop-color", "#f5c133")

      gradient.append("stop")
      .attr('class', 'end')
      .attr("offset", "100%")
      .attr("stop-color", "#f0e6ea")

      svg.selectAll("rect")
      	 .data(data)
	       .enter()
	       .append("rect")
	       .attr("y", function(d,i) {
	        return (yScale(parseDate(d.date)));
	      })
	      .attr("x", function(d) {
	        return ( xScale(parseTime(d.xStart)));
	      })
	      .attr("width", function(d) {
	        return (xScale(parseTime(d.xEnd)) - xScale(parseTime(d.xStart)))
	      })
        .attr("height", (h-horizPadding) / data.length)
        .attr("stroke", "url(#svgGradient)")
        .attr("stroke-width" , "2")
        .append("title")
        .text(function(d) {
           return (d.date + " - Sunrise: " + d.xStart + " Sunset: " + d.xEnd)
        })

        svg.append("g")
        	 .attr("class", "axis")
	         .attr("transform", "translate(0," + (h - padding) + ")")
	         .call(xAxis);

        svg.append("g")
	         .attr("class", "axis")
	         .attr("transform", "translate(" + horizPadding + ")")
           .call(yAxis);



    var reDrawPlot = function() {

      if(showingDLS){
	showingDLS = false;
	for (i = 0; i < data.length; i++) {
	  data[i].xStart = data[i].sunriseWoDLS
	  data[i].xEnd = data[i].sunsetWoDLS
	}
  d3.select("#transitionButton").text("Show with DST");
  d3.select("#statusText").text("Showing Sunrise and Sunset without Daylight Savings Time.");
     } else {
	showingDLS = true;
	for (i = 0; i < data.length; i++) {
	  data[i].xStart = data[i].sunrise
	  data[i].xEnd = data[i].sunset
	}
  d3.select("#transitionButton").text("Show without DST");
  d3.select("#statusText").text("Showing Sunrise and Sunset with Daylight Savings Time.");
     }

      svg.selectAll("rect")
      	 .data(data)
      	 .transition()
         .duration(2000)
//	       .enter()
//	       .append("rect")
	       .attr("y", function(d,i) {
	        return (yScale(parseDate(d.date)));
	      })
	      .attr("x", function(d) {
	        return ( xScale(parseTime(d.xStart)));
	      })
	      .attr("width", function(d) {
	        return (xScale(parseTime(d.xEnd)) - xScale(parseTime(d.xStart)))
	      })
        .attr("height", (h-horizPadding) / data.length)
        .attr("stroke", "url(#svgGradient)")
        .attr("stroke-width" , "2")
//        .append("title")
        .text(function(d) {
           return (d.date + " - Sunrise: " + d.xStart + " Sunset: " + d.xEnd)
        })

        svg.append("g")
        	 .attr("class", "axis")
	         .attr("transform", "translate(0," + (h - padding) + ")")
	         .call(xAxis);

        svg.append("g")
	         .attr("class", "axis")
	         .attr("transform", "translate(" + horizPadding + ")")
           .call(yAxis);


    }

    </script>
  </body>
</html>
