<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>NYS Tourny Winner Spreads</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="NYSTournyWinnerDataLoad.js"></script>
    <style>
      body {
       background-color: rgba(0,0,0,.1);
     }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        font-family: 'Lato', sans-serif;
      }
      .top {
        width: 100%;
        margin: 0 auto;
        background-color: #868c7a;
        text-align: center;
        height: 60px;
        color: white;
        padding: 15px 0px 15px 0px;
      }
      .col-small{
        flex 1 1 30%;
        padding: 5px;
      }
      .col-large{
        flex 2 1 65%;
        padding: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="top">
        <h4>NYS Tourny Winner Spreads</h4>
      </div>
      <div id="plot"></div>
      <div class="col-small">
        <form class="params">
          <label>Contest: </label>
          <select name="contest">
            <option selected>Three Man Ladder</option>
            <option>B Ladder</option>
            <option>C Ladder</option>
            <option>C Hose</option>
            <option>B Hose</option>
            <option>Efficiency</option>
            <option>Motor Pump</option>
            <option>Buckets</option>
          </select>
          <label>Show: </label>
          <select name="top5">
            <option selected>First Only</option>
            <option>Top 5</option>
          </select>
          <label>Stack on: </label>
          <select name="decimal">
            <option selected>Tenths</option>
            <option>Hundredths</option>
          </select>
          <label>Color control: </label>
          <select name="colorCtrl">
            <option selected>Years</option>
            <option>Place</option>
            <option>Team</option>
          </select>
          <div id="teamDiv">
            <select name="teamCtrl">
              <option selected>Central Islip Hoboes</option>
              <option>West Sayville Flying Dutchmen</option>
              <option>Patchogue Forty Thieves</option>
            </select>
          </div>
        </form>
      </div>
      <div class="col-large">
      </div>
    </div>
    <script>

      const inputs = document.querySelectorAll("form.params");
      const contestCtrl = inputs[0].elements.contest;
      const top5Ctrl = inputs[0].elements.top5;
      const decCtrl = inputs[0].elements.decimal;
      const colCtrl = inputs[0].elements.colorCtrl;
      const tmCtrl = inputs[0].elements.teamCtrl;

      function hideTeams() {
        var teamDiv = document.getElementById("teamDiv");
	if (colCtrl.value=="Team"){
          teamDiv.style.display = "block";
        } else {
          teamDiv.style.display = "none";
        }
      }


      function filterTimes(){
        let xPts = [], xPtsHighLt = [];
        let yPts = [], yPtsHighLt = [];
        let hoverTxt = [], hoverTxtHighLt = [];
        let years = [], yearsHighLt = [];
        let place = [], placeHighLt = [];


        function pushPt(x, hv, yr, pl, decLevel){
	  if(decLevel=="Tenths"){
            x.push(finishData[i].timeround);
          } else {
            x.push(finishData[i].time);
          }
          hv.push(finishData[i].year + " " + finishData[i].team + ": " +
                  finishData[i].time);
          yr.push(parseInt(finishData[i].year));
          pl.push(parseInt(finishData[i].place));
        }   




        if(top5Ctrl.value=="Top 5" && decCtrl.value == "Tenths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value){
	       if(colCtrl.value != "Team"){
                 pushPt(xPts, hoverTxt, years, place, "Tenths");
                 yPts.push(finishData[i].allYlocation10ths);
               } else if(finishData[i].team == tmCtrl.value){
                 pushPt(xPtsHighLt, hoverTxtHighLt, yearsHighLt, placeHighLt, "Tenths");
                 yPtsHighLt.push(finishData[i].allYlocation10ths);
               } else {
                 pushPt(xPts, hoverTxt, years, place, "Tenths");
                 yPts.push(finishData[i].allYlocation10ths);
               }             
            }
          }
        } else if (top5Ctrl.value=="First Only" && decCtrl.value == "Tenths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value &&
               finishData[i].firstsYlocation10ths != "NA"){
	       if(colCtrl.value != "Team"){
                 pushPt(xPts, hoverTxt, years, place, "Tenths");
                 yPts.push(finishData[i].firstsYlocation10ths);
               } else if(finishData[i].team == tmCtrl.value){
                 pushPt(xPtsHighLt, hoverTxtHighLt, yearsHighLt, placeHighLt, "Tenths");
                 yPtsHighLt.push(finishData[i].firstsYlocation10ths);
               } else {
                 pushPt(xPts, hoverTxt, years, place, "Tenths");
                 yPts.push(finishData[i].firstsYlocation10ths);
               }             
            }
          }
        } else if (top5Ctrl.value=="Top 5" && decCtrl.value == "Hundredths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value){
	       if(colCtrl.value != "Team"){
                 pushPt(xPts, hoverTxt, years, place, "Hundredths");
                 yPts.push(finishData[i].allYlocation100ths);
               } else if(finishData[i].team == tmCtrl.value){
                 pushPt(xPtsHighLt, hoverTxtHighLt, yearsHighLt, placeHighLt, "Hundredths");
                 yPtsHighLt.push(finishData[i].allYlocation100ths);
               } else {
                 pushPt(xPts, hoverTxt, years, place, "Hundredths");
                 yPts.push(finishData[i].allYlocation100ths);
               }             
            }
          }
        } else if (top5Ctrl.value=="First Only" &&
                   decCtrl.value == "Hundredths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value &&
               finishData[i].firstsYlocation100ths != "NA"){
	       if(colCtrl.value != "Team"){
                 pushPt(xPts, hoverTxt, years, place, "Hundredths");
                 yPts.push(finishData[i].firstsYlocation100ths);
               } else if(finishData[i].team == tmCtrl.value){
                 pushPt(xPtsHighLt, hoverTxtHighLt, yearsHighLt, placeHighLt, "Hundredths");
                 yPtsHighLt.push(finishData[i].firstsYlocation100ths);
               } else {
                 pushPt(xPts, hoverTxt, years, place, "Hundredths");
                 yPts.push(finishData[i].firstsYlocation100ths);
               }             
            }
          }
        }
        console.log(xPts);
	console.log(xPtsHighLt);

        let yMax = Math.max(...yPts, ...yPtsHighLt);
        let markerSize = Math.min(500/yMax, 20);
        let colShown = years;
        if(colCtrl.value=="Place"){colShown = place}
	if(colCtrl.value=="Team"){colShown = "grey"}
        var trace1 = {
          x: xPts,
          y: yPts,
          hovertemplate: '%{text}' +
                          '<extra></extra>',
          mode: 'markers',
          type: 'scatter',
          marker: { size: markerSize,
                    color: colShown, 
		    colorscale: "Greens",
		    reversescale: true, 
		    showscale: true},
          text: hoverTxt
        };
        var trace2 = {
          x: xPtsHighLt,
          y: yPtsHighLt,
          hovertemplate: '%{text}' +
                          '<extra></extra>',
          mode: 'markers',
          type: 'scatter',
          marker: { size: markerSize,
                    color: "dark blue"},
          text: hoverTxtHighLt
        };	      
	      
	      
        var data = [trace1, trace2];
        layout = {
          hovermode:'closest',
          height: 600,
          xaxis:{title: 'Times'},
          yaxis:{
            range: [0, yMax+.5],
            dtick: Math.round(yMax / 4),
            title: 'Count in Stack'
          }, 
          showlegend: true,
          sliders[].steps[]
        };
        Plotly.newPlot('plot', data, layout);
      }

      filterTimes();
      hideTeams();

      contestCtrl.addEventListener("change",() => { filterTimes(); hideTeams(); });
      top5Ctrl.addEventListener("change",() => { filterTimes(); hideTeams(); });
      decCtrl.addEventListener("change",() => { filterTimes(); hideTeams(); });
      colCtrl.addEventListener("change",() => { filterTimes(); hideTeams(); });
      tmCtrl.addEventListener("change",() => { filterTimes(); hideTeams(); });


    </script>
  </body>
</html>
