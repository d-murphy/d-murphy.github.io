
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>NYS Tourny Winner Spreads</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="NYSTournyWinnerDataLoad.js"></script>
    <style>
      body {
       background-color: rgba(0,0,0,.1);
     }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        font-family: 'Lato', sans-serif;
      }

      .top {
        width: 100%;
        margin: 0 auto;
        background-color: #868c7a;
        text-align: center;
        height: 60px;
        color: white;
        padding: 15px 0px 15px 0px;
      }

      .col-small{
        flex 1 1 30%;
        padding: 5px;
      }

      .col-large{
        flex 2 1 65%;
        padding: 5px;
      }

    </style>
  </head>
  <body>
    <div class="container">
      <div class="top">
        <h4>NYS Tourny Winner Spreads</h4>
      </div>
      <div id="plot"></div>
      <div class="col-small">
        <form class="params">
          <label>Contest: </label>
          <select name="contest">
            <option selected>Three Man Ladder</option>
            <option>B Ladder</option>
            <option>C Ladder</option>
            <option>C Hose</option>
            <option>B Hose</option>
            <option>Efficiency</option>
            <option>Motor Pump</option>
            <option>Buckets</option>
          </select>
          <label>Show: </label>
          <select name="top5">
            <option selected>First Only</option>
            <option>Top 5</option>
          </select>
          <label>Stack on: </label>
          <select name="decimal">
            <option selected>Tenths</option>
            <option>Hundredths</option>
          </select>
          <label>Color control: </label>
          <select name="colorCtrl">
            <option selected>Years</option>
            <option>Place</option>
          </select>
        </form>
      </div>
      <div class="col-large">
      </div>
    </div>
    <script>

      const inputs = document.querySelectorAll("form.params");
      const contestCtrl = inputs[0].elements.contest;
      const top5Ctrl = inputs[0].elements.top5;
      const decCtrl = inputs[0].elements.decimal;
      const colCtrl = inputs[0].elements.colorCtrl;

      function filterTimes(){
        let xPts = [];
        let yPts = [];
        let hoverTxt = [];
        let years = [];
        let place = [];

        if(top5Ctrl.value=="Top 5" && decCtrl.value == "Tenths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value){
              xPts.push(finishData[i].timeround);
              yPts.push(finishData[i].allYlocation10ths);
              hoverTxt.push(finishData[i].year + " " + finishData[i].team + ": "
                + finishData[i].time);
              years.push(parseInt(finishData[i].year));
              place.push(parseInt(finishData[i].place));
            }
          }
        } else if (top5Ctrl.value=="First Only" && decCtrl.value == "Tenths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value &&
               finishData[i].firstsYlocation10ths != "NA"){
              xPts.push(finishData[i].timeround);
              yPts.push(finishData[i].firstsYlocation10ths);
              hoverTxt.push(finishData[i].year + " " + finishData[i].team +
                            ": " + finishData[i].time);
              years.push(parseInt(finishData[i].year));
              place.push(parseInt(finishData[i].place));
            }
          }
        } else if (top5Ctrl.value=="Top 5" && decCtrl.value == "Hundredths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value){
              xPts.push(finishData[i].time);
              yPts.push(finishData[i].allYlocation100ths);
              hoverTxt.push(finishData[i].year + " " + finishData[i].team +
                            ": " + finishData[i].time);
              years.push(parseInt(finishData[i].year));
              place.push(parseInt(finishData[i].place));
            }
          }
        } else if (top5Ctrl.value=="First Only" &&
                   decCtrl.value == "Hundredths"){
          for(i=0;i<finishData.length;i++){
            if(finishData[i].contest == contestCtrl.value &&
               finishData[i].firstsYlocation100ths != "NA"){
              xPts.push(finishData[i].time);
              yPts.push(finishData[i].firstsYlocation100ths);
              hoverTxt.push(finishData[i].year + " " + finishData[i].team +
                            ": " + finishData[i].time);
              years.push(parseInt(finishData[i].year));
              place.push(parseInt(finishData[i].place));
            }
          }
        }

        let yMax = Math.max(...yPts);
        let markerSize = Math.min(500/yMax, 20);

        let colShown = years;
        if(colCtrl.value=="Place"){colShown = place}

        var trace1 = {
          x: xPts,
          y: yPts,
          hovertemplate: '%{text}' +
                          '<extra></extra>',
          mode: 'markers',
          type: 'scatter',
          name: "firsts",
          marker: { size: markerSize,
                    color: colShown},
          text: hoverTxt
        };

        var data = [trace1];

        layout = {
          hovermode:'closest',
          height: 600,
          xaxis:{title: 'Times'},
          yaxis:{
            range: [0, yMax+.5],
            dtick: Math.round(yMax / 4),
            title: 'Count in Stack'
          }
        };

        Plotly.newPlot('plot', data, layout);
      }

      filterTimes();

      contestCtrl.addEventListener("change", filterTimes);
      top5Ctrl.addEventListener("change", filterTimes);
      decCtrl.addEventListener("change", filterTimes);
      colCtrl.addEventListener("change", filterTimes);

    </script>
  </body>
</html>
